# ‚úÖ Secure AWS Terraform Example: PASS Nimbus Guard

## üìÑ Example Nimbus Guard Report (HTML Preview)

<details>
<summary>Click to expand full HTML report</summary>
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Nimbus Guard Report</title>
  <style>
    body {
      font-family: system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.5;
      padding: 24px;
    }
    h1, h2, h3, h4 {
      margin-top: 1.25em;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin: 12px 0;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 6px 8px;
      text-align: left;
    }
    th {
      background: #f5f5f5;
    }
    code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    }
    pre {
      background: #fafafa;
      border: 1px solid #eee;
      padding: 12px;
      overflow: auto;
    }
  </style>
</head>
<body>
  <h1 id="nimbus-guard-report">Nimbus Guard Report</h1>

  <p>
    <strong>Run Timestamp (UTC):</strong> 2025-11-05T10:04:38Z<br>
    <strong>Total Findings:</strong> 0<br>
    <strong>Fail Threshold:</strong> HIGH
  </p>

  <h2 id="findings-by-severity">Findings by Severity</h2>
  <table>
    <thead>
      <tr>
        <th style="text-align: right;">Severity</th>
        <th style="text-align: right;">Count</th>
      </tr>
    </thead>
    <tbody>
      <tr><td style="text-align: right;">CRITICAL</td><td style="text-align: right;">0</td></tr>
      <tr><td style="text-align: right;">HIGH</td><td style="text-align: right;">0</td></tr>
      <tr><td style="text-align: right;">MEDIUM</td><td style="text-align: right;">0</td></tr>
      <tr><td style="text-align: right;">LOW</td><td style="text-align: right;">0</td></tr>
      <tr><td style="text-align: right;">INFO</td><td style="text-align: right;">0</td></tr>
    </tbody>
  </table>

  <h2 id="findings-by-service">Findings by Service</h2>
  <table>
    <thead>
      <tr>
        <th style="text-align: right;">Service</th>
        <th style="text-align: right;">Count</th>
      </tr>
    </thead>
    <tbody>
      <tr><td colspan="2" style="text-align: center;">No findings</td></tr>
    </tbody>
  </table>

  <h2 id="details">Details</h2>
  <table>
    <thead>
      <tr>
        <th>Severity</th>
        <th>Service</th>
        <th>Region</th>
        <th>Resource</th>
        <th>Title</th>
      </tr>
    </thead>
    <tbody>
      <tr><td colspan="5" style="text-align: center;">No details available</td></tr>
    </tbody>
  </table>

  <h3 id="finding-details">Finding Details</h3>
  <p><em>Generated by Nimbus Guard. Report is self-contained and link-free.</em></p>
</body>
</html>
</details>

This Terraform example provisions a **secure AWS baseline** designed to **pass Nimbus Guard** checks with **no HIGH or CRITICAL findings**.  
It deploys compliant infrastructure across **`eu-west-1`** and **`eu-west-2`** regions, ensuring strong security controls and audit visibility.

---

## üß© What This Configuration Ensures

- **Root MFA** ‚Äì Must be configured manually (Terraform cannot enforce this).  
- **CloudTrail**
  - One **multi-region** trail, **actively logging**.
  - Logs stored in a **private, encrypted S3 bucket** with:
    - **Bucket-level Block Public Access (PAB)**.
    - A **strict, non-public bucket policy**.
- **S3 Account-Level Block Public Access**
  - All four PAB flags are **enabled** at the account level.
- **Security Groups**
  - No world-open ingress (e.g. `0.0.0.0/0` on SSH or RDP).  
  - A single locked-down security group allows SSH **only from your workstation**.
- **VPC**
  - Minimal, single-AZ VPC with public subnet (optional EC2 demo).
- **IAM**
  - A least-privilege role using AWS-managed `ReadOnlyAccess` policy.
  - No IAM users created.
- **VPC Flow Logs**
  - Enabled (to ACTIVE) for any **default VPC** found in `eu-west-1` and `eu-west-2`.
- **Encryption**
  - S3 bucket encryption enabled by default for all CloudTrail logs.

---

## ‚öôÔ∏è Variables

| Variable | Description | Example |
|-----------|--------------|----------|
| `allowed_ssh_cidr` | Your workstation IP/CIDR for SSH ingress | `203.0.113.4/32` |
| `cloudtrail_bucket_name` | Optional custom bucket name (must be globally unique) | `my-secure-logs-bucket` |

> ‚ö†Ô∏è The `allowed_ssh_cidr` variable is **required**,it is intentionally left empty by default to prevent accidental open SSH access.

---

## üöÄ Quick Start (PowerShell)

```powershell
cd examples/secure
terraform init
terraform plan -var "allowed_ssh_cidr=203.0.113.4/32"
terraform apply -var "allowed_ssh_cidr=203.0.113.4/32" -auto-approve
```

To specify a custom CloudTrail bucket name:

```powershell
terraform apply `
  -var "allowed_ssh_cidr=203.0.113.4/32" `
  -var "cloudtrail_bucket_name=my-secure-logs-bucket" `
  -auto-approve
```

---

## üß™ Validate with Nimbus Guard

1. After Terraform apply completes, run the **Nimbus Guard scanner** in the same AWS account and region(s).  
2. You should expect:
   - **No HIGH or CRITICAL findings** for:
     - Public S3 buckets  
     - Open security groups (SSH)  
     - IAM wildcard permissions  
     - Missing CloudTrail  

---

## üßπ Cleanup

When finished, safely destroy the demo resources:

```powershell
terraform destroy -var "allowed_ssh_cidr=203.0.113.4/32" -auto-approve
```

---

## üîí Notes & Safety

- Bucket names are randomized by default to avoid collisions.  
- The S3 bucket has **Block Public Access** enabled and **private ACLs only**.  
- The IAM role uses **AWS-managed `ReadOnlyAccess`**, avoiding over-permissive custom policies.  
- No IAM users are created, only a demo EC2-assumable role.

---

## üß≠ Next Steps

- Optionally, add a **tiny EC2 instance** in the public subnet to test SSH connectivity via the locked-down SG.  
- Generate an **outputs summary script** (URLs, IDs, CloudTrail ARNs) for integration testing.  
- Try the **insecure example** to see Nimbus Guard detect intentional misconfigurations.

---

*End of Secure Example, Nimbus Guard PASS Baseline*
